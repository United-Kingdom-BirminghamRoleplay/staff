<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Sharepoint</title>
    <link rel="icon" type="image/png" href="./images/ukbrum_png.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>

<body>
    <button class="mobile-menu-btn" id="mobileMenuBtn" style="position: fixed; top: 20px; left: 20px; z-index: 10002; background: #dc2626; color: white; border: none; border-radius: 8px; padding: 12px; width: 48px; height: 48px; display: block;">
        <i class="fas fa-bars"></i>
    </button>
    <div class="mobile-overlay" id="mobileOverlay"></div>
    <nav class="sidebar" id="sidebar">
        <ul class="sidebar-nav">
            <li><a href="index.html" class="nav-link active">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a></li>
            <li><a href="ranks.html" class="nav-link">
                <i class="fas fa-calendar-alt"></i>
                <span>Timetable</span>
            </a></li>
            <li><a href="melonlysystem.html" class="nav-link">
                <i class="fas fa-clipboard-list"></i>
                <span>Melonly System</span>
            </a></li>
            <li><a href="resources.html" class="nav-link">
                <i class="fas fa-tools"></i>
                <span>Resources</span>
            </a></li>
            <li><a href="forms.html" class="nav-link">
                <i class="fas fa-file-alt"></i>
                <span>Forms</span>
            </a></li>
        </ul>
        <div class="sidebar-logout">
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span class="logout-text">Logout</span>
            </button>
        </div>
    </nav>

    <main class="main-content">
        <section class="top-search">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="siteSearch" placeholder="Search Sharepoint Content..." class="search-input" autocomplete="off">
                    <button class="filter-btn"><i class="fas fa-filter"></i></button>
                </div>
            </div>
            <div id="searchResults" class="search-results"></div>
        </section>
        
        <section class="greeting-section">
            <h1 id="dynamicGreeting" class="greeting-text">Good Afternoon</h1>
            <div class="quick-access-grid">
                <div class="quick-box" onclick="window.location.href='#announcements'">
                    <i class="fas fa-bullhorn"></i>
                    <h4>Announcements</h4>
                </div>
                <div class="quick-box" onclick="window.location.href='ranks.html'">
                    <i class="fas fa-clock"></i>
                    <h4>Timetable</h4>
                </div>
                <div class="quick-box" onclick="window.location.href='melonlysystem.html'">
                    <i class="fas fa-clipboard-list"></i>
                    <h4>Melonly</h4>
                </div>
                <div class="quick-box" onclick="window.location.href='resources.html'">
                    <i class="fas fa-tools"></i>
                    <h4>Staff Material</h4>
                </div>
                <div class="quick-box" onclick="window.location.href='#contacts'">
                    <i class="fas fa-address-book"></i>
                    <h4>Contacts</h4>
                </div>
            </div>
        </section>

        <section class="announcements">
            <h2><i class="fas fa-bullhorn"></i> Recent Notices</h2>
            <div id="announcementsContainer">
                <!-- Announcements will be loaded dynamically -->
            </div>
        </section>
                


                        

        
        <section class="info-grid">
            <div class="info-box" onclick="window.location.href='ranks.html'">
                <i class="fas fa-users info-box-icon"></i>
                <h3>Rank Structure</h3>
                <p>View staff hierarchy and responsibilities</p>
            </div>
            <div class="info-box" onclick="window.location.href='melonlysystem.html'">
                <i class="fas fa-clipboard-list info-box-icon"></i>
                <h3>Melonly System</h3>
                <p>Access external logging system for violations</p>
            </div>
            <div class="info-box" onclick="window.location.href='resources.html'">
                <i class="fas fa-tools info-box-icon"></i>
                <h3>Resources</h3>
                <p>Staff guides, commands, and helpful tools</p>
            </div>
        </section>
        
        <section id="contacts" class="announcements">
            <h2><i class="fa-solid fa-address-book"></i>High Ranking Leaders Contact</h2>
            <p>These are all the contacts you will mainly need when being a High Ranking. If you have any issues regarding sessions, please contact your advisor as we do not have an team lead for sessions.</p>
            <br>
            <div class="staff-grid">
                <div class="staff-card">
                        <div class="staff-avatar">
                            <img src="" alt="" onerror="this.src='images/muddy.png'">
                            <div class="role-badge">Oversight Advisor</div>
                        </div>
                        <div class="staff-info">
                            <h3>Muddy</h3>
                        </div>
                    </div>
                    <div class="staff-card">
                        <div class="staff-avatar">
                            <img src="" alt="" onerror="this.src='images/maxx.png'">
                            <div class="role-badge">Oversight Advisor</div>
                        </div>
                        <div class="staff-info">
                            <h3>Max</h3>
                        </div>
                    </div>
                    <div class="staff-card">
                        <div class="staff-avatar">
                            <img src="" alt="" onerror="this.src='images/bobmanjeff.png'">
                            <div class="role-badge">Human Resources Advisor</div>
                        </div>
                        <div class="staff-info">
                            <h3>Bobman</h3>
                        </div>
                    </div>
                    <div class="staff-card">
                        <div class="staff-avatar">
                            <img src="" alt="" onerror="this.src='images/bracelet.png'">
                            <div class="role-badge">Head of Training</div>
                        </div>
                        <div class="staff-info">
                            <h3>Ryan</h3>
                        </div>
                    </div>
                    <div class="staff-card">
                        <div class="staff-avatar">
                            <img src="" alt="" onerror="this.src='images/karam.png'">
                            <div class="role-badge">Head of Training</div>
                        </div>
                        <div class="staff-info">
                            <h3>act1v.bov</h3>
                        </div>
                    </div>
            </div>
        </section>
        <section class="announcements"> 
            <h2><i class="fa-solid fa-bug"></i>Website Administrators</h2>
            <p>Please also notify one of our Website Administrators when one of the guidelines are outdated.</p>
            <br>    
            <div class="staff-grid">
                        <div class="staff-card">
                            <div class="staff-avatar developer">
                                <img src="" alt="" onerror="this.src='images/finn.png'">
                                <div class="role-badge developer">Lead Website Administrator</div>
                            </div>
                            <div class="staff-info">
                                <h3>Finn</h3>
                            </div>
                        </div>
                        <div class="staff-card">
                            <div class="staff-avatar developer">
                                <img src="" alt="" onerror="this.src='images/mrtrappy.png'">
                                <div class="role-badge developer">Website Administrator</div>
                            </div>
                            <div class="staff-info">
                                <h3>MrTrappy</h3>
                            </div>
                        </div>
                        <div class="staff-card">
                            <div class="staff-avatar developer">
                                <img src="" alt="" onerror="this.src='images/karam.png'">
                                <div class="role-badge developer">Website Administrator</div>
                            </div>
                            <div class="staff-info">
                                <h3>act1v.bov</h3>
                            </div>
                        </div>
                    </div>
        </section>



    </main>

    <footer>
        <p>&copy; 2025 Staff Sharepoint. All rights reserved.</p>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/roblox-search.js"></script>
    <script>
        async function loadAnnouncements() {
            const container = document.getElementById('announcementsContainer');
            let announcements = [];
            
            // Check localStorage first
            try {
                const stored = localStorage.getItem('announcements');
                if (stored) {
                    const data = JSON.parse(stored);
                    announcements = data.announcements || [];
                }
            } catch (e) {
                console.log('No stored announcements');
            }
            
            // If no stored announcements, try to load from file
            if (announcements.length === 0) {
                try {
                    const response = await fetch('./data/announcements.json');
                    const data = await response.json();
                    announcements = data.announcements || [];
                } catch (error) {
                    console.error('Error loading announcements:', error);
                }
            }
            
            // Display announcements
            if (announcements.length === 0) {
                container.innerHTML = `
                    <div class="announcement">
                        <i class="fas fa-info-circle announcement-icon"></i>
                        <div class="announcement-content">
                            <h4>There are no current notices</h4>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = announcements.map(announcement => `
                    <div class="announcement">
                        <i class="fas fa-${announcement.icon} announcement-icon"></i>
                        <div class="announcement-content">
                            <h4>${announcement.title}</h4>
                            <p>${announcement.content}</p>
                            <span class="date">Posted: ${announcement.date}</span>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'Good evening';
            
            if (hour >= 5 && hour < 12) greeting = 'Good Morning';
            else if (hour >= 12 && hour < 18) greeting = 'Good Afternoon';
            else greeting = 'Good Evening';
            
            const greetingEl = document.getElementById('dynamicGreeting');
            const authData = localStorage.getItem('ukbrum_auth');
            
            greetingEl.innerHTML = `<span style="font-size: 1.2em; font-weight: 800;">${greeting}</span><br><span style="font-size: 0.6em; opacity: 0.7; margin-top: 10px; display: block;">Welcome back to the Sharepoint!</span>`;
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('expanded');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadAnnouncements();
            updateGreeting();
            setInterval(updateGreeting, 60000);
        });
        
        // Update greeting when user logs in
        document.addEventListener('userLoggedIn', updateGreeting);
        
        function siteSearch() {
            const query = document.getElementById('siteSearch').value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (!query) {
                results.innerHTML = '';
                return;
            }
            
            const searchableElements = document.querySelectorAll('h1, h2, h3, h4, p, li');
            const matches = [];
            
            searchableElements.forEach(el => {
                if (el.textContent.toLowerCase().includes(query)) {
                    matches.push({
                        text: el.textContent.substring(0, 100) + '...',
                        element: el
                    });
                }
            });
            
            if (matches.length > 0) {
                results.innerHTML = matches.map(match => `
                    <div class="search-result" onclick="scrollToElement(this)">
                        <p>${match.text}</p>
                    </div>
                `).join('');
            } else {
                results.innerHTML = '<div class="no-results">No results found</div>';
            }
        }
        
        function openAnnouncementForm() {
            const authData = localStorage.getItem('ukbrum_auth');
            if (!authData) {
                alert('Please log in first.');
                return;
            }
            
            try {
                const user = JSON.parse(authData);
                if (user.rank !== 'senior_management') {
                    alert('Access denied. Only Senior Management can create announcements.');
                    return;
                }
            } catch (e) {
                alert('Authentication error. Please log in again.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'form-modal';
            modal.innerHTML = `
                <div class="form-modal-content">
                    <h3>Create Staff Announcement</h3>
                    <form id="announcementForm" onsubmit="saveAnnouncement(event)">
                        <input type="text" id="announcementTitle" placeholder="Announcement Title" required>
                        <textarea id="announcementContent" placeholder="Announcement Content" required></textarea>
                        <select id="announcementIcon">
                            <option value="bullhorn">Bullhorn</option>
                            <option value="info-circle">Info</option>
                            <option value="exclamation-triangle">Warning</option>
                        </select>
                        <button type="submit">Create Announcement</button>
                        <button type="button" onclick="this.closest('.form-modal').remove()">Cancel</button>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        async function saveAnnouncement(event) {
            event.preventDefault();
            const title = document.getElementById('announcementTitle').value;
            const content = document.getElementById('announcementContent').value;
            const icon = document.getElementById('announcementIcon').value;
            const date = new Date().toLocaleDateString();
            
            const newAnnouncement = {
                title: title,
                content: content,
                icon: icon,
                date: date
            };
            
            // Save to localStorage
            let announcements = [];
            try {
                const stored = localStorage.getItem('announcements');
                if (stored) {
                    announcements = JSON.parse(stored).announcements || [];
                }
            } catch (e) {
                announcements = [];
            }
            
            announcements.unshift(newAnnouncement);
            localStorage.setItem('announcements', JSON.stringify({ announcements }));
            
            // Add to page immediately
            const container = document.getElementById('announcementsContainer');
            const announcementEl = document.createElement('div');
            announcementEl.className = 'announcement';
            announcementEl.innerHTML = `
                <i class="fas fa-${icon} announcement-icon"></i>
                <div class="announcement-content">
                    <h4>${title}</h4>
                    <p>${content}</p>
                    <span class="date">Posted: ${date}</span>
                </div>
            `;
            container.insertBefore(announcementEl, container.firstChild);
            
            document.querySelector('.form-modal').remove();
            alert('Announcement created successfully!\n\nNote: This saves to browser storage only. In production, this would save to the server.');
        }
        
        function openFormBuilder() {
            const modal = document.createElement('div');
            modal.className = 'form-modal';
            modal.innerHTML = `
                <div class="form-modal-content form-builder">
                    <h3>Form Builder</h3>
                    <div class="form-builder-content">
                        <input type="text" id="formName" placeholder="Form Name" required>
                        <div id="formFields">
                            <div class="field-item">
                                <input type="text" placeholder="Field Label" class="field-label">
                                <select class="field-type">
                                    <option value="text">Text Input</option>
                                    <option value="textarea">Text Area</option>
                                    <option value="select">Dropdown</option>
                                    <option value="checkbox">Checkbox</option>
                                </select>
                                <button type="button" onclick="removeField(this)">Remove</button>
                            </div>
                        </div>
                        <button type="button" onclick="addField()">Add Field</button>
                        <div class="form-actions">
                            <button type="button" onclick="saveForm()">Save Form</button>
                            <button type="button" onclick="this.closest('.form-modal').remove()">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function addField() {
            const container = document.getElementById('formFields');
            const fieldItem = document.createElement('div');
            fieldItem.className = 'field-item';
            fieldItem.innerHTML = `
                <input type="text" placeholder="Field Label" class="field-label">
                <select class="field-type">
                    <option value="text">Text Input</option>
                    <option value="textarea">Text Area</option>
                    <option value="select">Dropdown</option>
                    <option value="checkbox">Checkbox</option>
                </select>
                <button type="button" onclick="removeField(this)">Remove</button>
            `;
            container.appendChild(fieldItem);
        }
        
        function removeField(btn) {
            btn.parentElement.remove();
        }
        
        function saveForm() {
            const formName = document.getElementById('formName').value;
            const fields = [];
            
            document.querySelectorAll('.field-item').forEach(item => {
                const label = item.querySelector('.field-label').value;
                const type = item.querySelector('.field-type').value;
                if (label) {
                    fields.push({ label, type });
                }
            });
            
            if (formName && fields.length > 0) {
                // Create form data
                const formData = {
                    name: formName,
                    fields: fields,
                    created: new Date().toISOString()
                };
                
                // Add to forms section
                const formsGrid = document.querySelector('.forms-grid');
                const newFormCard = document.createElement('div');
                newFormCard.className = 'form-card';
                newFormCard.innerHTML = `
                    <h4>${formName}</h4>
                    <p>Custom form with ${fields.length} fields</p>
                    <button class="btn-glass" onclick="openCustomForm('${formName}')">Open Form</button>
                `;
                formsGrid.appendChild(newFormCard);
                
                document.querySelector('.form-modal').remove();
                alert('Form created successfully!');
            } else {
                alert('Please fill in form name and add at least one field.');
            }
        }
        
        function logout() {
            if (window.authSystem) {
                window.authSystem.logout();
            } else {
                localStorage.removeItem('ukbrum_auth');
                location.reload();
            }
        }
        
        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('mobileOverlay');
        
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('expanded');
                overlay.classList.toggle('active');
            });
            
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('expanded');
                overlay.classList.remove('active');
            });
        }
        
        function openCustomForm(formName) {
            alert(`Opening custom form: ${formName}`);
        }
        
        // Add search functionality
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('siteSearch');
            if (searchInput) {
                searchInput.addEventListener('input', siteSearch);
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        siteSearch();
                    }
                });
            }
        });
    </script>
</body>

</html>